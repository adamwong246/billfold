<head>
  <title>billFold</title>
</head>

<body>
  <h1> BillFold </h1>
  <div id="outer">
    {{> grid }}
  </div>
</body>

<template name="grid">
  {{> loginButtons}}

  <h4> Add a new Bill </h4>
  <form class="new_bill">
    <input type="text" name="name" placeholder="bill name" />
    <br>
    <input type="number" name="amount" placeholder="amount" step="any" />
    <br>
    <label for="arrival_date">Arrival date</label>
    <input type="date" name="arrival_date" />
    <br>
    <label for="departure_date">Departure date</label>
    <input type="date" name="departure_date" />
    <br>
    <select name="owner" >
      {{#each users}}
        <option value="{{_id}}">{{identify_user _id}}</option>
      {{/each}}
    </select>
    <br>
    <input type="submit" value="New Bill">
  </form>

  <h4> Add a new UserBill </h4>
  <form class="new_user_bill">

    <select name="user" >
      {{#each users}}
        <option value="{{_id}}">{{identify_user _id}}</option>
      {{/each}}
    </select>
    <br>
    <select name="bill" >
      {{#each bills}}
        <option value="{{_id}}">{{name}}</option>
      {{/each}}
    </select>

    <br>
    <label for="arrival_date">Arrival date</label>
    <input type="date" name="arrival_date"/>
    <br>
    <label for="departure_date">Departure date</label>
    <input type="date" name="departure_date"/>
    <br>
    <input type="submit" value="New user bill">
  </form>

  <h4> Add a new payment </h4>
  <form class="new_payment">
    payer:
    <select name="payer" >
      {{#each users}}
        <option value="{{_id}}">{{identify_user this}}</option>
      {{/each}}
    </select>
    <br>
    payee:
    <select name="payee" >
      {{#each users}}
        <option value="{{_id}}">{{identify_user this}}</option>
      {{/each}}
    </select>
    <br>
    <input type="number" name="amount" placeholder="amount" step="any" />
    <br>
    <input type="submit" value="New Payment">
  </form>

  <h4> users </h4>
  <ol>
    {{#each users}}
      <li>
        {{> user}}
      </li>
    {{/each}}
  </ol>

  <h4> bills </h4>
  <table>
    {{#each bills}}
      {{> bill}}
    {{/each}}
  </table>

  <h4> user bills </h4>
  <table>
    {{#each user_bills}}
      {{> user_bill}}
    {{/each}}
  </table>

  <h4> payments </h4>
  <table>
    {{#each payments}}
      {{> payment}}
    {{/each}}
  </table>

  <h3>Balance sheet</h3>
  <table>
    <tr>
      <td></td>
      {{#each users}}
        <td>
          {{identify_user this}}
        </td>
      {{/each}}
    </tr>

    {{#each users}}
      <tr>
        <td>
          {{identify_user this}}
        </td>

        {{#each users}}
          <td>
            {{!identify_user this}}
            {{!identify_user ..}}
            {{user_owes_user payer=this payee=..}}
          </td>
        {{/each}}

      </tr>
    {{/each}}

  </table>

</template>

<template name="user">
  <div class="user">
    {{identify_user this}}
  </div>
</template>

<template name="bill">
  <tr class="bill">
    <td>
      {{name}}
    </td>
    <td>
      {{identify_user owner}}
    </td>
    <td>
      ${{amount}}
    </td>
    <td>
      {{prettifyDate arrival_date}}
    </td>
    <td>
      {{prettifyDate departure_date}}
    </td>
    <td>
      <input type="button" class="delete_bill" value="delete" data-billid={{_id}} />
    </td>
  </tr>
</template>

<template name="user_bill">
  <tr class="user_bill">
    <td>
      {{identify_user user}}
    </td>
    <td>
      {{identify_bill bill}}
    </td>
    <td>
      {{prettifyDate arrival_date}}
    </td>
    <td>
      {{prettifyDate departure_date}}
    </td>
    <td>
      ${{owed}}
    </td>
    <td>
      <input type="button" class="delete_user_bill" value="delete" data-userbillid={{_id}} />
    </td>
  </tr>
</template>

<template name="payment">
  <tr class="payment">
    <td>
      From: {{identify_user payer}}
    </td>
    <td>
      To: {{identify_user payee}}
    </td>
    <td>
      ${{amount}}
    </td>
    <td>
      <input type="button" class="delete_payment" value="delete" data-paymentid={{_id}} />
    </td>
  </tr>
</template>
